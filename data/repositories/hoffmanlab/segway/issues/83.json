{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "links": {"attachments": {"href": "data/repositories/hoffmanlab/segway/issues/83/attachments_page=1.json"}, "self": {"href": "data/repositories/hoffmanlab/segway/issues/83.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/83/watch"}, "comments": {"href": "data/repositories/hoffmanlab/segway/issues/83/comments_page=1.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/83/segway-layered-bed-file-output-is-not"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/83/vote"}}, "reporter": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "title": "Segway layered bed file output is not sorted and breaks --bigBed option", "component": null, "votes": 0, "watches": 1, "content": {"raw": "For DOHH2 hg38 an identify run with `--bigBed` produces the following error:\r\n```shell\r\n/mnt/work1/users/hoffmangroup/segway-protocol/tmp/segwayT3I9eP.bed is not case-sensitive sorted at line 11.  Please use \"sort -k1,1 -k2,2n\" with LC_COLLATE=C,  or bedSort and try again.\r\nTraceback (most recent call last):\r\n  File \"/mnt/work1/users/home2/eric.roberts/.local/bin/segway\", line 9, in <module>\r\n    load_entry_point('segway', 'console_scripts', 'segway')()\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/run.py\", line 2971, in main\r\n    return runner()\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/run.py\", line 2764, in __call__\r\n    self.run(*args, **kwargs)\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/run.py\", line 2755, in run\r\n    self.run_identify_posterior()\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/run.py\", line 2663, in run_identify_posterior\r\n    self.save_identify_posterior()\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/run.py\", line 2606, in save_identify_posterior\r\n    IdentifySaver(self)(world)\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/output.py\", line 148, in __call__\r\n    bigbed_outfilename=self.make_filename(self.bigbed_filename, world))\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py\", line 358, in layer\r\n    segmentation.save(outfilename, bigbed_outfilename)\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py\", line 270, in save\r\n    BEDTOBIGBED_PROG(bigbed_infilename, sizes_file.name, bigbed_outfilename)\r\n  File \"/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py\", line 270, in save\r\n    BEDTOBIGBED_PROG(bigbed_infilename, sizes_file.name, bigbed_outfilename)\r\n  File \"/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py\", line 81, in __call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py\", line 212, in run\r\n    self._getoutput(args, kwargs)\r\n  File \"/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py\", line 194, in _getoutput\r\n    stdin, stdout, stderr, cwd)\r\n  File \"/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py\", line 157, in _popen\r\n    _returncode_error_factory(cmdline, returncode, output, error)\r\n  File \"/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py\", line 57, in _returncode_error_factory\r\n    raise error_cls, (cmdline, returncode, output, error)\r\noptbuild.ReturncodeError: bedToBigBed returned 255\r\n```\r\n\r\nbedToBigBed is correctly reporting this issue as evidenced by the segway.layered.bed.gz output:\r\n\r\n```shell\r\n$ zcat segway.layered.bed.gz | head -n 12 | nl\r\n     1  track autoScale=off description=\"segway 10-label segmentation of H3K4me1, H3K4me3, H3K27ac, H3K27me3, CTCF\" viewLimits=0:1 visibility=full name=segway.151388ae750c11e686895254004fdc17 itemRgb=on\r\n     2  chr20_GL383577v2_alt    0       128386  0       1000    .       0       128386  27,158,119      2       1,1     0,128385\r\n     3  chr20_GL383577v2_alt    0       128386  1       1000    .       0       128386  217,95,2        1       128386  0\r\n     4  chr20_GL383577v2_alt    0       128386  2       1000    .       0       128386  117,112,179     2       1,1     0,128385\r\n     5  chr20_GL383577v2_alt    0       128386  3       1000    .       0       128386  231,41,138      2       1,1     0,128385\r\n     6  chr20_GL383577v2_alt    0       128386  4       1000    .       0       128386  102,166,30      2       1,1     0,128385\r\n     7  chr20_GL383577v2_alt    0       128386  5       1000    .       0       128386  230,171,2       2       1,1     0,128385\r\n     8  chr20_GL383577v2_alt    0       128386  6       1000    .       0       128386  166,118,29      2       1,1     0,128385\r\n     9  chr20_GL383577v2_alt    0       128386  7       1000    .       0       128386  102,102,102     2       1,1     0,128385\r\n    10  chr20_GL383577v2_alt    0       128386  8       1000    .       0       128386  27,158,119      2       1,1     0,128385\r\n    11  chr20_GL383577v2_alt    0       128386  9       1000    .       0       128386  217,95,2        2       1,1     0,128385\r\n    12  chr17_KI270861v1_alt    0       196688  0       1000    .       0       196688  27,158,119      2       1,1     0,196687\r\n```", "markup": "markdown", "html": "<p>For DOHH2 hg38 an identify run with <code>--bigBed</code> produces the following error:</p>\n<div class=\"codehilite language-shell\"><pre><span></span>/mnt/work1/users/hoffmangroup/segway-protocol/tmp/segwayT3I9eP.bed is not <span class=\"k\">case</span>-sensitive sorted at line <span class=\"m\">11</span>.  Please use <span class=\"s2\">&quot;sort -k1,1 -k2,2n&quot;</span> with <span class=\"nv\">LC_COLLATE</span><span class=\"o\">=</span>C,  or bedSort and try again.\nTraceback <span class=\"o\">(</span>most recent call last<span class=\"o\">)</span>:\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/.local/bin/segway&quot;</span>, line <span class=\"m\">9</span>, in &lt;module&gt;\n    load_entry_point<span class=\"o\">(</span><span class=\"s1\">&#39;segway&#39;</span>, <span class=\"s1\">&#39;console_scripts&#39;</span>, <span class=\"s1\">&#39;segway&#39;</span><span class=\"o\">)()</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/run.py&quot;</span>, line <span class=\"m\">2971</span>, in main\n    <span class=\"k\">return</span> runner<span class=\"o\">()</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/run.py&quot;</span>, line <span class=\"m\">2764</span>, in __call__\n    self.run<span class=\"o\">(</span>*args, **kwargs<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/run.py&quot;</span>, line <span class=\"m\">2755</span>, in run\n    self.run_identify_posterior<span class=\"o\">()</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/run.py&quot;</span>, line <span class=\"m\">2663</span>, in run_identify_posterior\n    self.save_identify_posterior<span class=\"o\">()</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/run.py&quot;</span>, line <span class=\"m\">2606</span>, in save_identify_posterior\n    IdentifySaver<span class=\"o\">(</span>self<span class=\"o\">)(</span>world<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/output.py&quot;</span>, line <span class=\"m\">148</span>, in __call__\n    <span class=\"nv\">bigbed_outfilename</span><span class=\"o\">=</span>self.make_filename<span class=\"o\">(</span>self.bigbed_filename, world<span class=\"o\">))</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py&quot;</span>, line <span class=\"m\">358</span>, in layer\n    segmentation.save<span class=\"o\">(</span>outfilename, bigbed_outfilename<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py&quot;</span>, line <span class=\"m\">270</span>, in save\n    BEDTOBIGBED_PROG<span class=\"o\">(</span>bigbed_infilename, sizes_file.name, bigbed_outfilename<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/users/home2/eric.roberts/segway/segway/layer.py&quot;</span>, line <span class=\"m\">270</span>, in save\n    BEDTOBIGBED_PROG<span class=\"o\">(</span>bigbed_infilename, sizes_file.name, bigbed_outfilename<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py&quot;</span>, line <span class=\"m\">81</span>, in __call__\n    <span class=\"k\">return</span> self.run<span class=\"o\">(</span>*args, **kwargs<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py&quot;</span>, line <span class=\"m\">212</span>, in run\n    self._getoutput<span class=\"o\">(</span>args, kwargs<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py&quot;</span>, line <span class=\"m\">194</span>, in _getoutput\n    stdin, stdout, stderr, cwd<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py&quot;</span>, line <span class=\"m\">157</span>, in _popen\n    _returncode_error_factory<span class=\"o\">(</span>cmdline, returncode, output, error<span class=\"o\">)</span>\n  File <span class=\"s2\">&quot;/mnt/work1/software/python/2.7/lib/python2.7/site-packages/optbuild.py&quot;</span>, line <span class=\"m\">57</span>, in _returncode_error_factory\n    raise error_cls, <span class=\"o\">(</span>cmdline, returncode, output, error<span class=\"o\">)</span>\noptbuild.ReturncodeError: bedToBigBed returned <span class=\"m\">255</span>\n</pre></div>\n\n\n<p>bedToBigBed is correctly reporting this issue as evidenced by the segway.layered.bed.gz output:</p>\n<div class=\"codehilite language-shell\"><pre><span></span>$ zcat segway.layered.bed.gz <span class=\"p\">|</span> head -n <span class=\"m\">12</span> <span class=\"p\">|</span> nl\n     <span class=\"m\">1</span>  track <span class=\"nv\">autoScale</span><span class=\"o\">=</span>off <span class=\"nv\">description</span><span class=\"o\">=</span><span class=\"s2\">&quot;segway 10-label segmentation of H3K4me1, H3K4me3, H3K27ac, H3K27me3, CTCF&quot;</span> <span class=\"nv\">viewLimits</span><span class=\"o\">=</span><span class=\"m\">0</span>:1 <span class=\"nv\">visibility</span><span class=\"o\">=</span>full <span class=\"nv\">name</span><span class=\"o\">=</span>segway.151388ae750c11e686895254004fdc17 <span class=\"nv\">itemRgb</span><span class=\"o\">=</span>on\n     <span class=\"m\">2</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">0</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">27</span>,158,119      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">3</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">1</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">217</span>,95,2        <span class=\"m\">1</span>       <span class=\"m\">128386</span>  <span class=\"m\">0</span>\n     <span class=\"m\">4</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">2</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">117</span>,112,179     <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">5</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">3</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">231</span>,41,138      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">6</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">4</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">102</span>,166,30      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">7</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">5</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">230</span>,171,2       <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">8</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">6</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">166</span>,118,29      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n     <span class=\"m\">9</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">7</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">102</span>,102,102     <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n    <span class=\"m\">10</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">8</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">27</span>,158,119      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n    <span class=\"m\">11</span>  chr20_GL383577v2_alt    <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">9</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">128386</span>  <span class=\"m\">217</span>,95,2        <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,128385\n    <span class=\"m\">12</span>  chr17_KI270861v1_alt    <span class=\"m\">0</span>       <span class=\"m\">196688</span>  <span class=\"m\">0</span>       <span class=\"m\">1000</span>    .       <span class=\"m\">0</span>       <span class=\"m\">196688</span>  <span class=\"m\">27</span>,158,119      <span class=\"m\">2</span>       <span class=\"m\">1</span>,1     <span class=\"m\">0</span>,196687\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2016-09-07T18:44:12.267198+00:00", "milestone": null, "updated_on": "2016-09-14T15:27:23.902843+00:00", "type": "issue", "id": 83}
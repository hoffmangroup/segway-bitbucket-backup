{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "links": {"attachments": {"href": "data/repositories/hoffmanlab/segway/issues/2/attachments_page=1.json"}, "self": {"href": "data/repositories/hoffmanlab/segway/issues/2.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/2/watch"}, "comments": {"href": "data/repositories/hoffmanlab/segway/issues/2/comments_page=1.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/2/lsf_unit_for_limits-not-used-for-resource"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/2/vote"}}, "reporter": {"display_name": "Jay Hesselberth", "uuid": "{ba6c3099-0fad-4fe3-8aac-9429e99631c1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bba6c3099-0fad-4fe3-8aac-9429e99631c1%7D"}, "html": {"href": "https://bitbucket.org/%7Bba6c3099-0fad-4fe3-8aac-9429e99631c1%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/049cb0ae5e8c23023c2e48b92a391744d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJH-6.png"}}, "nickname": "jayhesselberth", "type": "user", "account_id": "557058:b5b61d92-1c2c-4bff-8c23-3d28f323ab21"}, "title": "LSF_UNIT_FOR_LIMITS not used for resource requests", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Our LSF system is set up with GB as the LSF_UNIT_FOR_LIMITS:\r\n\r\n    $ badmin showconf mbd | grep UNIT\r\n        LSF_UNIT_FOR_LIMITS = GB\r\n\r\nAnd segway.cluster.lsf parses this correctly as the DIVISOR_FOR_LIMITS from our lsf.conf file.\r\n\r\nHowever, for the resource request, the DIVISOR_FOR_LIMITS is ignored and instead is specified in MB, irrespective of the configured unit:\r\n\r\n    select[mem>2148 && tmp>48] rusage[mem=2148, tmp=48]\r\n\r\nSo on our system, segway is asking for 2148 GB, which is awesome, but exceeds that RAM on our compute blades.  The jobs stay in PEND status and never run.\r\n\r\nThis comment in lsf.py::make_res_req() suggests that resources are always specified in MB:\r\n\r\n        # always specified in MB, unaffected by LSF_UNIT_FOR_LIMITS\r\n        # see Administering Platform LSF: Working with Resources:\r\n        # Understanding Resources\r\n\r\nI looked at that document, and don't see the logic for always specifying resources in MB.\r\n\r\nSo:\r\n\r\n1. Updating to the following in segway.cluster.lsf lets my jobs run:\r\n\r\n        mem_usage_mb = ceildiv(mem_usage, DIVISOR_FOR_LIMITS)\r\n        tmp_usage_mb = ceildiv(tmp_usage, DIVISOR_FOR_LIMITS)\r\n\r\n2. Does the comment suggest that we are somehow inappropriately managing LSF? I can't change LSF_UNIT_FOR_LIMITS, it would affect many users.\r\n\r\n", "markup": "markdown", "html": "<p>Our LSF system is set up with GB as the LSF_UNIT_FOR_LIMITS:</p>\n<div class=\"codehilite\"><pre><span></span>$ badmin showconf mbd <span class=\"p\">|</span> grep UNIT\n    <span class=\"nv\">LSF_UNIT_FOR_LIMITS</span> <span class=\"o\">=</span> GB\n</pre></div>\n\n\n<p>And segway.cluster.lsf parses this correctly as the DIVISOR_FOR_LIMITS from our lsf.conf file.</p>\n<p>However, for the resource request, the DIVISOR_FOR_LIMITS is ignored and instead is specified in MB, irrespective of the configured unit:</p>\n<div class=\"codehilite\"><pre><span></span>select[mem&gt;2148 &amp;&amp; tmp&gt;48] rusage[mem=2148, tmp=48]\n</pre></div>\n\n\n<p>So on our system, segway is asking for 2148 GB, which is awesome, but exceeds that RAM on our compute blades.  The jobs stay in PEND status and never run.</p>\n<p>This comment in lsf.py::make_res_req() suggests that resources are always specified in MB:</p>\n<div class=\"codehilite\"><pre><span></span>    # always specified in MB, unaffected by LSF_UNIT_FOR_LIMITS\n    # see Administering Platform LSF: Working with Resources:\n    # Understanding Resources\n</pre></div>\n\n\n<p>I looked at that document, and don't see the logic for always specifying resources in MB.</p>\n<p>So:</p>\n<ol>\n<li>\n<p>Updating to the following in segway.cluster.lsf lets my jobs run:</p>\n<div class=\"codehilite\"><pre><span></span>mem_usage_mb = ceildiv(mem_usage, DIVISOR_FOR_LIMITS)\ntmp_usage_mb = ceildiv(tmp_usage, DIVISOR_FOR_LIMITS)\n</pre></div>\n\n\n</li>\n<li>\n<p>Does the comment suggest that we are somehow inappropriately managing LSF? I can't change LSF_UNIT_FOR_LIMITS, it would affect many users.</p>\n</li>\n</ol>", "type": "rendered"}, "assignee": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2014-03-28T12:34:30.671856+00:00", "milestone": null, "updated_on": "2014-03-29T14:23:02.623032+00:00", "type": "issue", "id": 2}
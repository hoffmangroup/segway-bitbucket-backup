{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/29516907.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-29516907"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Job script file creation:\n\n\n```\n#!python\n\n        with open(job_script_filename, \"w\") as job_script_file:\n            print >>job_script_file, \"#!/usr/bin/env bash\"\n            # this doesn't include use of segway-wrapper, which takes the\n            # memory usage as an argument, and may be run multiple times\n            self.log_cmdline(gmtk_cmdline, args, job_script_file)\n\n        # set permissions for script to run\n        chmod(job_script_filename, JOB_SCRIPT_FILE_PERMISSIONS)\n```\n\n\nWith the ```with``` statement, the file resource should be automatically closed properly. So current theories are that in the job script file creation, chmod is slow and/or non-atomic. Possible alternatives include creating the file as presented in [this example](http://stackoverflow.com/a/5624691)?\n\nI am currently still unable to reproduce this, but will keep trying.", "markup": "markdown", "html": "<p>Job script file creation:</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">job_script_filename</span><span class=\"p\">,</span> <span class=\"s2\">&quot;w&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">job_script_file</span><span class=\"p\">:</span>\n            <span class=\"k\">print</span> <span class=\"o\">&gt;&gt;</span><span class=\"n\">job_script_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;#!/usr/bin/env bash&quot;</span>\n            <span class=\"c1\"># this doesn&#39;t include use of segway-wrapper, which takes the</span>\n            <span class=\"c1\"># memory usage as an argument, and may be run multiple times</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">log_cmdline</span><span class=\"p\">(</span><span class=\"n\">gmtk_cmdline</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"n\">job_script_file</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># set permissions for script to run</span>\n        <span class=\"n\">chmod</span><span class=\"p\">(</span><span class=\"n\">job_script_filename</span><span class=\"p\">,</span> <span class=\"n\">JOB_SCRIPT_FILE_PERMISSIONS</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>With the <code>with</code> statement, the file resource should be automatically closed properly. So current theories are that in the job script file creation, chmod is slow and/or non-atomic. Possible alternatives include creating the file as presented in <a data-is-external-link=\"true\" href=\"http://stackoverflow.com/a/5624691\" rel=\"nofollow\">this example</a>?</p>\n<p>I am currently still unable to reproduce this, but will keep trying.</p>", "type": "rendered"}, "created_on": "2016-07-28T21:33:15.692145+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "updated_on": "2016-07-29T13:35:45.208152+00:00", "type": "issue_comment", "id": 29516907}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/29537032.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-29537032"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Can now confirm that I was able to reproduce this issue.\n\nHave tried using ```fchmod``` and ```fsync``` on the file handle and am still unable to resolve the issue.\n\nEDIT: possibly related? https://github.com/PacificBiosciences/FALCON/issues/269 issues with NFS caching (sync vs async)", "markup": "markdown", "html": "<p>Can now confirm that I was able to reproduce this issue.</p>\n<p>Have tried using <code>fchmod</code> and <code>fsync</code> on the file handle and am still unable to resolve the issue.</p>\n<p>EDIT: possibly related? <a href=\"https://github.com/PacificBiosciences/FALCON/issues/269\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/PacificBiosciences/FALCON/issues/269</a> issues with NFS caching (sync vs async)</p>", "type": "rendered"}, "created_on": "2016-07-29T17:01:02.542200+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "updated_on": "2016-07-29T17:44:54.145874+00:00", "type": "issue_comment", "id": 29537032}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/29538281.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-29538281"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "The issue is most likely caused by NFS 3's default asynchronous behavior:\n\n```\n#!html\n\n>  The only thing I can think of is the fact that we change the \n> permissions on the file and writing out the metadata doesn't actually \n> complete by the time the separate process starts. When digging through \n> NFS docs I found that by default this is asynchronous behaviour:\n> \n>  \" This default permits the server to reply to client requests as soon \n> as it has processed the request and handed it off to the local file \n> system, without waiting for the data to be written to stable storage.\"\n> \n>  We've tried to fsync the file after changing permissions and before \n> using it but we also found the following:\n> \n>  \"Finally, note that, for NFS version 3 protocol requests, a \n> subsequent commit request from the NFS client at file close time, or \n> at fsync() time, will force the server to write any previously \n> unwritten data/metadata to the disk, and the server will not reply to \n> the client until this has been completed, as long as sync behavior is \n> followed. If async is used, the commit is essentially a no-op, since \n> the server once again lies to the client, telling the client that the \n> data has been sent to stable storage\".\n> \n>  If our scripts are indeed being stored on NFS then I can see why we \n> can't really work around this issue.\n\n```\n\nmordor is indeed running on NFS 3. Apparently there are plans to eventually migrate to NFS 4.\n\nSome things to note are: we might not get the error when running on the full cluster because of the time required to queue a job (rather than rapid-fire on a single node). Possible solutions suggested include: write only a single 'template' shell script and fill in the template as necessary for jobs: ie, queue the template script + arguments to fill in. \n\nUsers running on local will not get this error. It is difficult to reproduce even on a single node.", "markup": "markdown", "html": "<p>The issue is most likely caused by NFS 3's default asynchronous behavior:</p>\n<div class=\"codehilite language-html\"><pre><span></span>&gt;  The only thing I can think of is the fact that we change the \n&gt; permissions on the file and writing out the metadata doesn&#39;t actually \n&gt; complete by the time the separate process starts. When digging through \n&gt; NFS docs I found that by default this is asynchronous behaviour:\n&gt; \n&gt;  &quot; This default permits the server to reply to client requests as soon \n&gt; as it has processed the request and handed it off to the local file \n&gt; system, without waiting for the data to be written to stable storage.&quot;\n&gt; \n&gt;  We&#39;ve tried to fsync the file after changing permissions and before \n&gt; using it but we also found the following:\n&gt; \n&gt;  &quot;Finally, note that, for NFS version 3 protocol requests, a \n&gt; subsequent commit request from the NFS client at file close time, or \n&gt; at fsync() time, will force the server to write any previously \n&gt; unwritten data/metadata to the disk, and the server will not reply to \n&gt; the client until this has been completed, as long as sync behavior is \n&gt; followed. If async is used, the commit is essentially a no-op, since \n&gt; the server once again lies to the client, telling the client that the \n&gt; data has been sent to stable storage&quot;.\n&gt; \n&gt;  If our scripts are indeed being stored on NFS then I can see why we \n&gt; can&#39;t really work around this issue.\n</pre></div>\n\n\n<p>mordor is indeed running on NFS 3. Apparently there are plans to eventually migrate to NFS 4.</p>\n<p>Some things to note are: we might not get the error when running on the full cluster because of the time required to queue a job (rather than rapid-fire on a single node). Possible solutions suggested include: write only a single 'template' shell script and fill in the template as necessary for jobs: ie, queue the template script + arguments to fill in. </p>\n<p>Users running on local will not get this error. It is difficult to reproduce even on a single node.</p>", "type": "rendered"}, "created_on": "2016-07-29T18:32:22.939334+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "updated_on": null, "type": "issue_comment", "id": 29538281}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/29540263.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-29540263"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Suggestion 1: open with `os.O_SYNC`. Something like:\n\n```\n#!python\n\nJOB_SCRIPT_FILE_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_SYNC | os.O_TRUNC\n\njob_script_fd = os.open(job_script_filename, JOB_SCRIPT_FILE_OPEN_FLAGS, JOB_SCRIPT_FILE_PERMISSIONS)\nwith os.fdopen(job_script_fd, \"w\") as job_script_file:\n```\n\nThis way you can set the mode at opening too instead of `fchmod()` while it is open which is a bit odd.\n\nSuggestion 2: `segway-wrapper` can copy the file to its temporary directory (which we should document must be on local storage) and then run it from there.", "markup": "markdown", "html": "<p>Suggestion 1: open with <code>os.O_SYNC</code>. Something like:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">JOB_SCRIPT_FILE_OPEN_FLAGS</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">O_WRONLY</span> <span class=\"o\">|</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">O_CREAT</span> <span class=\"o\">|</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">O_SYNC</span> <span class=\"o\">|</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">O_TRUNC</span>\n\n<span class=\"n\">job_script_fd</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">job_script_filename</span><span class=\"p\">,</span> <span class=\"n\">JOB_SCRIPT_FILE_OPEN_FLAGS</span><span class=\"p\">,</span> <span class=\"n\">JOB_SCRIPT_FILE_PERMISSIONS</span><span class=\"p\">)</span>\n<span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">fdopen</span><span class=\"p\">(</span><span class=\"n\">job_script_fd</span><span class=\"p\">,</span> <span class=\"s2\">&quot;w&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">job_script_file</span><span class=\"p\">:</span>\n</pre></div>\n\n\n<p>This way you can set the mode at opening too instead of <code>fchmod()</code> while it is open which is a bit odd.</p>\n<p>Suggestion 2: <code>segway-wrapper</code> can copy the file to its temporary directory (which we should document must be on local storage) and then run it from there.</p>", "type": "rendered"}, "created_on": "2016-07-29T21:15:44.268248+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "updated_on": null, "type": "issue_comment", "id": 29540263}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/29540272.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-29540272"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Use standard coding practices with regard to imports if you implement something like that.", "markup": "markdown", "html": "<p>Use standard coding practices with regard to imports if you implement something like that.</p>", "type": "rendered"}, "created_on": "2016-07-29T21:16:32.309952+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "updated_on": null, "type": "issue_comment", "id": 29540272}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/31804831.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-31804831"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Another option is to avoid opening the file containing the job command for writing if the file already exists. There is already a mechanism in Segway for job resubmission for odd machine/environment issues and I feel like this is a good case for it. Potentially avoiding a rewrite of the job file might avoid a \"text file busy\".", "markup": "markdown", "html": "<p>Another option is to avoid opening the file containing the job command for writing if the file already exists. There is already a mechanism in Segway for job resubmission for odd machine/environment issues and I feel like this is a good case for it. Potentially avoiding a rewrite of the job file might avoid a \"text file busy\".</p>", "type": "rendered"}, "created_on": "2016-10-31T15:56:52.515587+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": null, "type": "issue_comment", "id": 31804831}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/31804887.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-31804887"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "created_on": "2016-10-31T15:58:25.846912+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": null, "type": "issue_comment", "id": 31804887}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/31913416.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-31913416"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Suggestion 3: Potentially run the command in segway-wrapper using \"bash\" in front of the file to be run.\n\nAlso recommended to open the file with flags instead of writing it out after opening. -@ericr86", "markup": "markdown", "html": "<p>Suggestion 3: Potentially run the command in segway-wrapper using \"bash\" in front of the file to be run.</p>\n<p>Also recommended to open the file with flags instead of writing it out after opening. -@ericr86</p>", "type": "rendered"}, "created_on": "2016-11-04T15:26:23.759964+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "updated_on": "2017-01-18T15:21:31.800479+00:00", "type": "issue_comment", "id": 31913416}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/33635690.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-33635690"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Another backup idea: find a way to poll if the file is busy within `segway-wrapper`. Try \"Suggestion 1\" and \"Suggestion 3\" above first", "markup": "markdown", "html": "<p>Another backup idea: find a way to poll if the file is busy within <code>segway-wrapper</code>. Try \"Suggestion 1\" and \"Suggestion 3\" above first</p>", "type": "rendered"}, "created_on": "2017-01-13T18:59:33.664027+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "updated_on": null, "type": "issue_comment", "id": 33635690}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/33637139.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-33637139"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "It's worth noting that `subprocess.Popen` is not thread safe and may be the source of all of these issues. Notably there's a chance that multiple threads can end up having the same process ID.\n\nSee:\nhttp://pythonhosted.org/psutil/#popen-class\nhttp://stackoverflow.com/questions/21194380/is-subprocess-popen-not-thread-safe\n\nIt might be worth investigating using a more thread-safe option such as psutil or a backported Python 3 implementation of subprocess (https://pypi.python.org/pypi/subprocess32/).", "markup": "markdown", "html": "<p>It's worth noting that <code>subprocess.Popen</code> is not thread safe and may be the source of all of these issues. Notably there's a chance that multiple threads can end up having the same process ID.</p>\n<p>See:\n<a href=\"http://pythonhosted.org/psutil/#popen-class\" rel=\"nofollow\" class=\"ap-connect-link\">http://pythonhosted.org/psutil/#popen-class</a>\n<a href=\"http://stackoverflow.com/questions/21194380/is-subprocess-popen-not-thread-safe\" rel=\"nofollow\" class=\"ap-connect-link\">http://stackoverflow.com/questions/21194380/is-subprocess-popen-not-thread-safe</a></p>\n<p>It might be worth investigating using a more thread-safe option such as psutil or a backported Python 3 implementation of subprocess (<a href=\"https://pypi.python.org/pypi/subprocess32/\" rel=\"nofollow\" class=\"ap-connect-link\">https://pypi.python.org/pypi/subprocess32/</a>).</p>", "type": "rendered"}, "created_on": "2017-01-13T20:53:19.642210+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": null, "type": "issue_comment", "id": 33637139}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/33637172.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-33637172"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Also from my investigation of this issue:\n\n- Not re-writing the file on resubmission doesn't seem to fix the issue\n\n- The files being submitted as a job work on their own when resubmitted after Segway is finished\n\n- Can't reproduce locally or as a submitted job (on NFS) when running everything as a single thread and forcing SEGWAY_NUM_LOCAL_JOBS to 1\n\n- Can reproduce locally with 10 threads and a max of 2 local jobs (SEGWAY_NUM_LOCAL_JOBS=2)", "markup": "markdown", "html": "<p>Also from my investigation of this issue:</p>\n<ul>\n<li>\n<p>Not re-writing the file on resubmission doesn't seem to fix the issue</p>\n</li>\n<li>\n<p>The files being submitted as a job work on their own when resubmitted after Segway is finished</p>\n</li>\n<li>\n<p>Can't reproduce locally or as a submitted job (on NFS) when running everything as a single thread and forcing SEGWAY_NUM_LOCAL_JOBS to 1</p>\n</li>\n<li>\n<p>Can reproduce locally with 10 threads and a max of 2 local jobs (SEGWAY_NUM_LOCAL_JOBS=2)</p>\n</li>\n</ul>", "type": "rendered"}, "created_on": "2017-01-13T20:55:34.071575+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2017-01-16T16:45:29.156553+00:00", "type": "issue_comment", "id": 33637172}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/33737039.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-33737039"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "\"Suggestion 1\" seems to fix the problem locally - I cannot reproduce.\n\n\"Suggestion 1\" does not seem to fix the problem running on NFS.", "markup": "markdown", "html": "<p>\"Suggestion 1\" seems to fix the problem locally - I cannot reproduce.</p>\n<p>\"Suggestion 1\" does not seem to fix the problem running on NFS.</p>", "type": "rendered"}, "created_on": "2017-01-17T19:28:01.899365+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2017-01-17T19:28:08.559145+00:00", "type": "issue_comment", "id": 33737039}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/33771002.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-33771002"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "And Suggestion 3? [edited to make clearer distinction from Suggestion 1]", "markup": "markdown", "html": "<p>And Suggestion 3? [edited to make clearer distinction from Suggestion 1]</p>", "type": "rendered"}, "created_on": "2017-01-18T15:22:22.592510+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "updated_on": null, "type": "issue_comment", "id": 33771002}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/34203399.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-34203399"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Fixed in PR #71", "markup": "markdown", "html": "<p>Fixed in <a href=\"#!/hoffmanlab/segway/pull-requests/71/fix-bad-interprter-text-file-busy-error\" rel=\"nofollow\" class=\"ap-connect-link\">PR #71</a></p>", "type": "rendered"}, "created_on": "2017-02-06T18:24:25.172333+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": null, "type": "issue_comment", "id": 34203399}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77/comments/34203408.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/77#comment-34203408"}}, "issue": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/issues/77.json"}}, "type": "issue", "id": 77, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "title": "GMTK jobs report \"bad interpreter: Text file busy\""}, "content": {"raw": "Fixed in PR #71", "markup": "markdown", "html": "<p>Fixed in <a href=\"#!/hoffmanlab/segway/pull-requests/71/fix-bad-interprter-text-file-busy-error\" rel=\"nofollow\" class=\"ap-connect-link\">PR #71</a></p>", "type": "rendered"}, "created_on": "2017-02-06T18:24:36.691512+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": null, "type": "issue_comment", "id": 34203408}], "page": 1, "size": 15}
{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "links": {"attachments": {"href": "data/repositories/hoffmanlab/segway/issues/93/attachments_page=1.json"}, "self": {"href": "data/repositories/hoffmanlab/segway/issues/93.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/93/watch"}, "comments": {"href": "data/repositories/hoffmanlab/segway/issues/93/comments_page=1.json"}, "html": {"href": "#!/hoffmanlab/segway/issues/93/jobstab-occassionally-missing-lines-line"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/issues/93/vote"}}, "reporter": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "title": "Jobs.tab occassionally missing lines - line Buffering for jobs.tab", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Currently jobs.tab is opened with a system default buffering scheme. On most systems this means that the file is fully buffered. In segway there are even calls to \"flush\" in hopes to force a write out of the current submitted job (in cluster/__init__.py). \"flush\" does not guarentee a write out and a ```os.fsync(f.fileno())``` is necessary to guarentee it on synchronous filesystems.\r\n\r\nSince each job is a tab-seperated line it would make sense if the jobs.tab file was opened with line buffering enabled. This might also help alleviate issues where sometimes there are missing newlines in the jobs.tab.\r\n\r\nAnother note that the same file handle is shared between all threads. Regular os.writes are not thread safe as they all advance the file pointer. There is potential cases where the jobs.tab has it's file pointer advancing by newer jobs and an older job still has it's file pointer to a previous location potentially overwriting a line.\r\n\r\nAnother potential solution is to have a separate jobs.tab per instance. This would isolate each jobs.tab on a per thread basis.", "markup": "markdown", "html": "<p>Currently jobs.tab is opened with a system default buffering scheme. On most systems this means that the file is fully buffered. In segway there are even calls to \"flush\" in hopes to force a write out of the current submitted job (in cluster/<strong>init</strong>.py). \"flush\" does not guarentee a write out and a <code>os.fsync(f.fileno())</code> is necessary to guarentee it on synchronous filesystems.</p>\n<p>Since each job is a tab-seperated line it would make sense if the jobs.tab file was opened with line buffering enabled. This might also help alleviate issues where sometimes there are missing newlines in the jobs.tab.</p>\n<p>Another note that the same file handle is shared between all threads. Regular os.writes are not thread safe as they all advance the file pointer. There is potential cases where the jobs.tab has it's file pointer advancing by newer jobs and an older job still has it's file pointer to a previous location potentially overwriting a line.</p>\n<p>Another potential solution is to have a separate jobs.tab per instance. This would isolate each jobs.tab on a per thread basis.</p>", "type": "rendered"}, "assignee": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "state": "new", "version": null, "edited_on": null, "created_on": "2016-11-16T16:12:58.944190+00:00", "milestone": null, "updated_on": "2016-11-30T16:53:03.452014+00:00", "type": "issue", "id": 93}
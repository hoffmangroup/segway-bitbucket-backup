{"pagelen": 50, "values": [{"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "a1503e066cd1", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/a1503e066cd1"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/a1503e066cd1"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "MERGED", "author": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "date": "2020-01-23T19:33:17.348386+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"approval": {"date": "2020-01-23T19:29:56.461299+00:00", "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "a1503e066cd1", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/a1503e066cd1"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/a1503e066cd1"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-23T05:23:29.160084+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "38f36f3ac4a4", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/38f36f3ac4a4"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/38f36f3ac4a4"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-17T16:42:07.498283+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "38f36f3ac4a4", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/38f36f3ac4a4"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/38f36f3ac4a4"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-17T16:42:06.334933+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "576dcc8a50a7", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/576dcc8a50a7"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/576dcc8a50a7"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-17T15:35:47.327633+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/132014556.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-132014556"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "@{5ac790531b5dd37ea53a123d} Please merge with the default branch \\(contains fixes\\) so we can test on cluster systems", "markup": "markdown", "html": "<p><span class=\"ap-mention\" data-atlassian-id=\"5ac790531b5dd37ea53a123d\">@Matthew McNeil</span> Please merge with the default branch (contains fixes) so we can test on cluster systems</p>", "type": "rendered"}, "created_on": "2020-01-16T21:27:44.377277+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2020-01-16T21:27:44.387774+00:00", "type": "pullrequest_comment", "id": 132014556}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "0a8389b37827", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/0a8389b37827"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/0a8389b37827"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-10T22:12:05.948703+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "3ff081422e0f", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/3ff081422e0f"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/3ff081422e0f"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-10T21:20:31.046516+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "ac6be1eb9f9a", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/ac6be1eb9f9a"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/ac6be1eb9f9a"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-10T19:28:28.034081+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130956340.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130956340"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "need an empty line before this", "markup": "markdown", "html": "<p>need an empty line before this</p>", "type": "rendered"}, "created_on": "2020-01-09T04:52:33.238120+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:52:33.245625+00:00", "type": "pullrequest_comment", "id": 130956340}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130955642.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130955642"}}, "parent": {"id": 130955309, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130955309.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130955309"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Maybe this won\u2019t work since your prior array is also multidimensional. Never mind then.", "markup": "markdown", "html": "<p>Maybe this won\u2019t work since your prior array is also multidimensional. Never mind then.</p>", "type": "rendered"}, "created_on": "2020-01-09T04:39:30.688996+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:39:30.697480+00:00", "type": "pullrequest_comment", "id": 130955642}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130955505.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130955505"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "`0s`", "markup": "markdown", "html": "<p><code>0s</code></p>", "type": "rendered"}, "created_on": "2020-01-09T04:36:41.167847+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:36:41.180172+00:00", "type": "pullrequest_comment", "id": 130955505}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130955392.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130955392"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Fix indent. If it\u2019s too long, break this into multiple assignments.", "markup": "markdown", "html": "<p>Fix indent. If it\u2019s too long, break this into multiple assignments.</p>", "type": "rendered"}, "created_on": "2020-01-09T04:34:37.765123+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:34:37.770566+00:00", "type": "pullrequest_comment", "id": 130955392}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130955309.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130955309"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "You are doing something similar here and in `downsample_presence_array()`. This should be a new function, similar to:\n\n```\nfrom numpy import pad\n\ndef window_array(arr, stride):\n    pad_length = len(arr) % stride\n    arr_padded = pad(arr, (0, pad_length), constant_values=0)\n    \n    # first dimension inferred\n    return arr_padded.reshape((-1, stride))\n```\n\nIn `downsample_presence_array()` you can just call `.sum()` along the correct axis to do a fast sum.", "markup": "markdown", "html": "<p>You are doing something similar here and in <code>downsample_presence_array()</code>. This should be a new function, similar to:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">numpy</span> <span class=\"kn\">import</span> <span class=\"n\">pad</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">window_array</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">,</span> <span class=\"n\">stride</span><span class=\"p\">):</span>\n    <span class=\"n\">pad_length</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"n\">stride</span>\n    <span class=\"n\">arr_padded</span> <span class=\"o\">=</span> <span class=\"n\">pad</span><span class=\"p\">(</span><span class=\"n\">arr</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">pad_length</span><span class=\"p\">),</span> <span class=\"n\">constant_values</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># first dimension inferred</span>\n    <span class=\"k\">return</span> <span class=\"n\">arr_padded</span><span class=\"o\">.</span><span class=\"kp\">reshape</span><span class=\"p\">((</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">stride</span><span class=\"p\">))</span>\n</pre></div>\n\n\n<p>In <code>downsample_presence_array()</code> you can just call <code>.sum()</code> along the correct axis to do a fast sum.</p>", "type": "rendered"}, "created_on": "2020-01-09T04:32:44.734460+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:32:44.741480+00:00", "type": "pullrequest_comment", "id": 130955309}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953803.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953803"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Please use standard list spacing even in comments", "markup": "markdown", "html": "<p>Please use standard list spacing even in comments</p>", "type": "rendered"}, "created_on": "2020-01-09T04:03:45.674425+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T04:04:03.092620+00:00", "type": "pullrequest_comment", "id": 130953803}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953550.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953550"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "`sum as numpy_sum `and fix below", "markup": "markdown", "html": "<p><code>sum as numpy_sum</code>and fix below</p>", "type": "rendered"}, "created_on": "2020-01-09T03:59:07.335601+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:59:07.341606+00:00", "type": "pullrequest_comment", "id": 130953550}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953308.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953308"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "close on previous line", "markup": "markdown", "html": "<p>close on previous line</p>", "type": "rendered"}, "created_on": "2020-01-09T03:54:32.355108+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:54:32.363899+00:00", "type": "pullrequest_comment", "id": 130953308}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953285.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953285"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Please close things like this at end of last line.", "markup": "markdown", "html": "<p>Please close things like this at end of last line.</p>", "type": "rendered"}, "created_on": "2020-01-09T03:54:05.534157+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:54:05.539446+00:00", "type": "pullrequest_comment", "id": 130953285}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953259.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953259"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Can you add `SegwayWarning(UserWarning)` in `_util.py`, import it here and then subclass this from `SegwayWarning` instead? This will make it easier for people to set filters for _all_ Segway warnings in the future if they exist.\n\nRename this `VirtualEvidenceWarning`. ", "markup": "markdown", "html": "<p>Can you add <code>SegwayWarning(UserWarning)</code> in <code>_util.py</code>, import it here and then subclass this from <code>SegwayWarning</code> instead? This will make it easier for people to set filters for <em>all</em> Segway warnings in the future if they exist.</p>\n<p>Rename this <code>VirtualEvidenceWarning</code>. </p>", "type": "rendered"}, "created_on": "2020-01-09T03:53:47.057197+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:53:47.062221+00:00", "type": "pullrequest_comment", "id": 130953259}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130953032.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130953032"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "`\"\"\"User-supplied priors sum to greater than one.\"\"\"`", "markup": "markdown", "html": "<p><code>\"\"\"User-supplied priors sum to greater than one.\"\"\"</code></p>", "type": "rendered"}, "created_on": "2020-01-09T03:49:07.457706+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:49:07.463221+00:00", "type": "pullrequest_comment", "id": 130953032}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130952993.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130952993"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "```\ncomponent_weight = round(1.0 / self.num_mix_components, ROUND_NDIGITS)\nweights = (\" \" + component_weight) * self.num_mix_components\n```\n\n\u200c", "markup": "markdown", "html": "<div class=\"codehilite\"><pre><span></span>component_weight = round(1.0 / self.num_mix_components, ROUND_NDIGITS)\nweights = (&quot; &quot; + component_weight) * self.num_mix_components\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-01-09T03:48:09.001134+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:48:09.006653+00:00", "type": "pullrequest_comment", "id": 130952993}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130952710.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130952710"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Empty line before comment block.\n\n```\n# Number of digits for rounding input.master means. This allows consistency between Python 2 and Python 3\n# TODO[PY2-EOL]: remove\n```\n\n\u200c", "markup": "markdown", "html": "<p>Empty line before comment block.</p>\n<div class=\"codehilite\"><pre><span></span># Number of digits for rounding input.master means. This allows consistency between Python 2 and Python 3\n# TODO[PY2-EOL]: remove\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-01-09T03:42:34.894122+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:44:30.325995+00:00", "type": "pullrequest_comment", "id": 130952710}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130952744.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130952744"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "For comments that describe the things beneath them you always need a blank line on top so it is clear what they refer to. This is an issue elsewhere also.", "markup": "markdown", "html": "<p>For comments that describe the things beneath them you always need a blank line on top so it is clear what they refer to. This is an issue elsewhere also.</p>", "type": "rendered"}, "created_on": "2020-01-09T03:43:14.313541+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:43:29.018906+00:00", "type": "pullrequest_comment", "id": 130952744}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130952572.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130952572"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Remove extra space", "markup": "markdown", "html": "<p>Remove extra space</p>", "type": "rendered"}, "created_on": "2020-01-09T03:39:44.363057+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:39:44.369808+00:00", "type": "pullrequest_comment", "id": 130952572}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130952553.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130952553"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Can this just be `#ifdef VIRTUAL_EVIDENCE`?", "markup": "markdown", "html": "<p>Can this just be <code>#ifdef VIRTUAL_EVIDENCE</code>?</p>", "type": "rendered"}, "created_on": "2020-01-09T03:39:26.758773+00:00", "user": {"display_name": "Michael Hoffman", "uuid": "{ffa8e039-5d4d-4f69-a4ba-ac25cbaf700b}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D"}, "html": {"href": "https://bitbucket.org/%7Bffa8e039-5d4d-4f69-a4ba-ac25cbaf700b%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/6a95e857a02504cbad5fe965c9d9e4bbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMH-1.png"}}, "nickname": "hoffman", "type": "user", "account_id": "557058:a9657985-692c-405c-995b-4e41cda7ba2b"}, "inline": {}, "updated_on": "2020-01-09T03:39:26.764019+00:00", "type": "pullrequest_comment", "id": 130952553}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "ecfa8015e80e", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/ecfa8015e80e"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/ecfa8015e80e"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-08T20:20:30.509224+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "61a17046ef20", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/61a17046ef20"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/61a17046ef20"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-08T20:13:04.933853+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "6ff3a92c06a4", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/6ff3a92c06a4"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/6ff3a92c06a4"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-08T19:01:23.469984+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "9c72d2354684", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/9c72d2354684"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/9c72d2354684"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-08T18:41:54.198700+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130600311.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130600311"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "This is much better. However I think there\u2019s still a bit of overengineering here. This is supposed to be a wrapper around effectively a `abs(reference - value) <= EPSILON` kind of deal. Ideally there should only be one return type \\(a boolean\\). Returning `True` if actually close enough and raise a warning otherwise \\(from my understanding of Michael\u2019s original request\\). Outside this function, the callee should use the prior sums should be checked with something like `any` which you are doing here. ", "markup": "markdown", "html": "<p>This is much better. However I think there\u2019s still a bit of overengineering here. This is supposed to be a wrapper around effectively a <code>abs(reference - value) &lt;= EPSILON</code> kind of deal. Ideally there should only be one return type (a boolean). Returning <code>True</code> if actually close enough and raise a warning otherwise (from my understanding of Michael\u2019s original request). Outside this function, the callee should use the prior sums should be checked with something like <code>any</code> which you are doing here. </p>", "type": "rendered"}, "created_on": "2020-01-06T20:23:11.324741+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2020-01-06T20:23:11.331651+00:00", "type": "pullrequest_comment", "id": 130600311}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "cbcb52433a70", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/cbcb52433a70"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/cbcb52433a70"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-06T20:20:50.518823+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130599919.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130599919"}}, "parent": {"id": 130599487, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130599487.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130599487"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Yes sorry.", "markup": "markdown", "html": "<p>Yes sorry.</p>", "type": "rendered"}, "created_on": "2020-01-06T20:19:16.902995+00:00", "user": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "inline": {}, "updated_on": "2020-01-06T20:19:16.913047+00:00", "type": "pullrequest_comment", "id": 130599919}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130599487.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130599487"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "This format string doesn\u2019t refer to `over_indexes` at all. Was it meant to be `+` ? `close_indexes + start` ?", "markup": "markdown", "html": "<p>This format string doesn\u2019t refer to <code>over_indexes</code> at all. Was it meant to be <code>+</code> ? <code>close_indexes + start</code> ?</p>", "type": "rendered"}, "created_on": "2020-01-06T20:14:36.414884+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2020-01-06T20:14:36.421654+00:00", "type": "pullrequest_comment", "id": 130599487}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130598918.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130598918"}}, "parent": {"id": 130583320, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130583320.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130583320"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "@{557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee} The concerns over the fucntion should be addressed now. There are minor test case updates to be made from the changes that I\u2019ll do today and tomorrow to get this ready for a full review.", "markup": "markdown", "html": "<p><span class=\"ap-mention ap-mention-me\" data-atlassian-id=\"557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee\">@Eric Roberts</span> The concerns over the fucntion should be addressed now. There are minor test case updates to be made from the changes that I\u2019ll do today and tomorrow to get this ready for a full review.</p>", "type": "rendered"}, "created_on": "2020-01-06T20:08:45.024720+00:00", "user": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "updated_on": "2020-01-06T20:08:45.039783+00:00", "type": "pullrequest_comment", "id": 130598918}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "bbc8fa827947", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/bbc8fa827947"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/bbc8fa827947"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-06T19:56:59.430336+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130589896.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130589896"}}, "parent": {"id": 130586350, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130586350.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130586350"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Yes the negative values should probably be checked elsewhere \\(if they aren\u2019t already\\). If they were originally checked outside this function before this change you can restore those changes.", "markup": "markdown", "html": "<p>Yes the negative values should probably be checked elsewhere (if they aren\u2019t already). If they were originally checked outside this function before this change you can restore those changes.</p>", "type": "rendered"}, "created_on": "2020-01-06T18:46:31.066464+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2020-01-06T18:46:31.075520+00:00", "type": "pullrequest_comment", "id": 130589896}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130586350.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130586350"}}, "parent": {"id": 130585988, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130585988.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130585988"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Do we want a separate function to check for negative priors then? Obviously it would need to be moved if we are summing beforehand.\n\nMakes perfect sense about start, I\u2019ll fix that.", "markup": "markdown", "html": "<p>Do we want a separate function to check for negative priors then? Obviously it would need to be moved if we are summing beforehand.</p>\n<p>Makes perfect sense about start, I\u2019ll fix that.</p>", "type": "rendered"}, "created_on": "2020-01-06T18:13:33.575654+00:00", "user": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "inline": {}, "updated_on": "2020-01-06T18:13:33.582938+00:00", "type": "pullrequest_comment", "id": 130586350}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130585988.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130585988"}}, "parent": {"id": 130584012, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130584012.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130584012"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "I believe the idea was to sum before sending it to the function.\n\nTo clarify I meant that the callee of the function should provide the context with `start` in this example instead of passing it as a parameter. For example the callee would try/catch and provide more context in the case of the exception \\(with the `start` variable if necessary\\)", "markup": "markdown", "html": "<p>I believe the idea was to sum before sending it to the function.</p>\n<p>To clarify I meant that the callee of the function should provide the context with <code>start</code> in this example instead of passing it as a parameter. For example the callee would try/catch and provide more context in the case of the exception (with the <code>start</code> variable if necessary)</p>", "type": "rendered"}, "created_on": "2020-01-06T18:09:56.700723+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2020-01-06T18:09:56.711693+00:00", "type": "pullrequest_comment", "id": 130585988}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130584012.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130584012"}}, "parent": {"id": 130583000, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130583000.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130583000"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "I\u2019ll add a reference to the function in case this is ever needed to check another number.\n\nI\u2019m not sure the advantage of summing the lines individually before sending it to check\\_is\\_close\\(\\). To do this we\u2019d either need to explicitly sum before sending to the function or use it at a downstream location, `get_downsampled_virtual_evidence_data_and_presence` where they are already summed. Doing the latter would mean that we are no longer able to give the chromosomal indices which go over reference. \n\nYou\u2019re correct, the start parameter was me trying to make the error message more informative and allows us to give the exact chromosomal indices which are over reference. I\u2019m not sure how you\u2019d use context for this problem.", "markup": "markdown", "html": "<p>I\u2019ll add a reference to the function in case this is ever needed to check another number.</p>\n<p>I\u2019m not sure the advantage of summing the lines individually before sending it to check_is_close(). To do this we\u2019d either need to explicitly sum before sending to the function or use it at a downstream location, <code>get_downsampled_virtual_evidence_data_and_presence</code> where they are already summed. Doing the latter would mean that we are no longer able to give the chromosomal indices which go over reference. </p>\n<p>You\u2019re correct, the start parameter was me trying to make the error message more informative and allows us to give the exact chromosomal indices which are over reference. I\u2019m not sure how you\u2019d use context for this problem.</p>", "type": "rendered"}, "created_on": "2020-01-06T17:50:24.573934+00:00", "user": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "inline": {}, "updated_on": "2020-01-06T17:50:24.584814+00:00", "type": "pullrequest_comment", "id": 130584012}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130583320.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130583320"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "@{5ac790531b5dd37ea53a123d} This is ready for your revision", "markup": "markdown", "html": "<p><span class=\"ap-mention\" data-atlassian-id=\"5ac790531b5dd37ea53a123d\">@Matthew McNeil</span> This is ready for your revision</p>", "type": "rendered"}, "created_on": "2020-01-06T17:43:33.260448+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2020-01-06T17:43:33.270329+00:00", "type": "pullrequest_comment", "id": 130583320}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130583000.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130583000"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "There probably wasn\u2019t enough clarity in the `check_is_close` initial discussion regarding on how roughly it should look. The objective was just to abstract the old `EPSILON` checks out into a function in case we want to change the exact behavior in the future \\(using np.is\\_close or some other threshold\\). So I believe the function signature should look something like `check_is_close(value, reference)` or something along those lines where potentially the prior sum takes place outside the function before calling it \\(from my understanding\\) and `reference` in most cases would simply be called with a value of `1.0`.\n\nThe `start` parameter also seems out of place. I\u2019m not even quite sure what it means but it looks like it\u2019s strictly used for better error reporting. In this case, it would be better, as you have to raise the custom warning and have the caller use its context \\(with `start`\\) for a better error report.\n\nUnit tests are welcome on this function.", "markup": "markdown", "html": "<p>There probably wasn\u2019t enough clarity in the <code>check_is_close</code> initial discussion regarding on how roughly it should look. The objective was just to abstract the old <code>EPSILON</code> checks out into a function in case we want to change the exact behavior in the future (using np.is_close or some other threshold). So I believe the function signature should look something like <code>check_is_close(value, reference)</code> or something along those lines where potentially the prior sum takes place outside the function before calling it (from my understanding) and <code>reference</code> in most cases would simply be called with a value of <code>1.0</code>.</p>\n<p>The <code>start</code> parameter also seems out of place. I\u2019m not even quite sure what it means but it looks like it\u2019s strictly used for better error reporting. In this case, it would be better, as you have to raise the custom warning and have the caller use its context (with <code>start</code>) for a better error report.</p>\n<p>Unit tests are welcome on this function.</p>", "type": "rendered"}, "created_on": "2020-01-06T17:40:30.424625+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2020-01-06T17:40:30.431629+00:00", "type": "pullrequest_comment", "id": 130583000}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/130496933.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-130496933"}}, "parent": {"id": 129814579, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129814579.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129814579"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Sorry for missing that. I\u2019ve added a function which does this now. It will raise a warning and give the chromosomal indexes for locations where priors are > 1 and raise a value error if they\u2019re less than 0. If this is what\u2019s wanted I will update the unit tests to match.\n\n\u200c", "markup": "markdown", "html": "<p>Sorry for missing that. I\u2019ve added a function which does this now. It will raise a warning and give the chromosomal indexes for locations where priors are &gt; 1 and raise a value error if they\u2019re less than 0. If this is what\u2019s wanted I will update the unit tests to match.</p>\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-01-06T06:17:30.219847+00:00", "user": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "inline": {}, "updated_on": "2020-01-06T06:17:30.229946+00:00", "type": "pullrequest_comment", "id": 130496933}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"update": {"description": "## Introduction\r\n\r\nThis pull request implements virtual evidence for all available segway tasks, building off of existing work from both Rachel Chan and Max Libbrecht\u2019s implementations of VE for training.\r\n\r\nDescription provided by Rachel Chan in her original [pull request](#!/hoffmanlab/segway/pull-requests/98) is as follows:  \r\nSpecifically, a binary virtual evidence node C has been added, which supplies the prior probability that the parent \\(segment label\\) A at a particular position is a particular label \\(ie P\\(C=1|A=a\\)\\).\r\n\r\nIn other words, the binary virtual child C exists only to constrain the parent \\(segment label\\) to be a particular value \\(supervised label\\) with the specified prior probability.\r\n\r\nI have also added a presence node such that positions with no prior specified by the user will have no virtual evidence.\r\n\r\nThe revised part of the graphical model is as below, where Qt is the segment label at position t, Ct is the virtual evidence child, and oCt indicates the presence of Ct. The black dotted line indicates a deterministic dependence where the parent of Ct switches based on the value of oCt; the red line indicates a stochastic conditional dependence \\(as there is a different Ct|Qt CPT at each t.\\)\r\n\r\n![](https://bitbucket.org/repo/a7MnLo/images/3913472725-graph_changes.png)\r\n\u200c\r\n\r\n## User Interface\r\n\r\nNo change for users not running Virtual Evidence.\r\n\r\nUsers supplying virtual evidence while running an entire task together \\(ie segway train or segway annotate\\) will supply the virtual evidence file with --virtual-evidence.\r\n\r\nUsers supplying virtual evidence while running steps for a task one at a time will need to specify --virtual-evidence during the init step in order to properly generate the input files such as input.master and the tri file. The tri file will be generated from GMTK without the virtual evidence specification, and will therefore be missing virtual evidence tracks unless it is specified during init. This can be a placeholder, though a warning will be shown saying the file does not exist. Whatever is supplied by --virtual-evidence during train-init will then be passed to train-run. This file can however be overridden by using the --virtual-evidence option again for train-run or train-run-round.\r\n\r\nDuring annotate and posterior a file can be supplied with the --virtual-evidence option to the init step however it may not be changed during run.\r\n\r\nIn addition to support for virtual-evidence with the more modular API, two new model variables have been added, --track-weight and --virtual-evidence-weight. The track weight applies an exponent to all track data provided to the model to skew it away from uniform, while virtual evidence weight does the same thing for virtual evidence data specifically.\r\n\r\n## Input File\r\n\r\nThe virtual evidence file should be of BED3\\+2 format where the 4th column is the label index and the fifth column is the prior. For example,\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\nIf running on multiple worlds, the VE file is in BED3\\+3 format instead, and the world number must be specified for each row in the last column. If this is omitted and a BED3\\+2 file is submitted instead, the virtual evidence will be applied to all worlds instead. Using the previous example, in the second world,\r\n\r\n`chr1 0 1000 0 0.9 1`\r\n\r\nThese examples specify a prior probability of 0.9 on label 0 and 0.05 on label 1 at chr1\\(0,1000\\).\r\n\r\nAt positions for which some labels are given a prior by the user but other labels not, the remaining probability is uniformly distributed amongst the leftover labels. For example, with 4 labels:\r\n\r\n`chr1 0 1000 0 0.4`\r\n\r\nall labels but label 0 would be given a prior probability of \\(1-0.4\\)/3=0.2.\r\n\r\n## Resolution and downsampling\r\n\r\nSection taken from Rachel Chan\u2019s original PR, with very slight modification for new interface:\r\n\r\nIn order to downsample virtual evidence \\(`get_downsampled_virtual_evidence_data_and_presence`\\), I decided to implement the following rule:\r\n\r\nLet resolution be greater than 1. For positions which have some priors specified but not all, compute uniform priors for the remaining labels and take the average prior probability \\(over the position axis\\) over these positions. The presence is then the number of positions that have any priors specified.\r\n\r\nFor example, with 3 total labels with resolution 10:\r\n\r\n`chr1 0 1 0 0.5`\r\n\r\n`chr1 0 1 1 0.2`\r\n\r\n`chr1 1 2 1 0.4`\r\n\r\nthis expands \\(inferring uniform priors for remaining labels\\) into:\r\n\r\n`label 0 1 2`\r\n\r\n`chr1 0 1 0.5 0.2 0.3`\r\n\r\n`chr1 1 2 0.3 0.4 0.3`\r\n\r\nwe take the average over these positions to obtain:\r\n\r\n`1 chr1 0 10 0.4 0.3 0.4`\r\n\r\nwith presence 2.\r\n\r\nNow let resolution equal 1. Then the presence is simply 1 or 0; 1 for positions with priors specified, and 0 for positions without. For positions with priors specified, uniform priors are inferred for any remaining labels, and this becomes the prior vector for that position.\r\n\r\nIn both cases, positions with no priors specified are given 0 presence and uniform priors for all labels.\r\n\r\n## Test case\r\n\r\nThis is a test case created and described by Rachel Chan. We supply the following virtual evidence priors to the simpleseg test case:\r\n\r\n`chr1 0 1000 0 0.9`\r\n\r\n`chr1 4000 5000 0 0.9`\r\n\r\nThis is able to separate the binary 0,0 and 0,1 regions in simpleseg, creating the following annotation:\r\n\r\n`chr1 0 1000 0 1000 . 0 1000 27,158,119`\r\n\r\n`chr1 1000 2000 1 1000 . 1000 2000 217,95,2`\r\n\r\n`chr1 2000 3000 2 1000 . 2000 3000 117,112,179`\r\n\r\n`chr1 3000 4000 3 1000 . 3000 4000 231,41,138`\r\n\r\n`chr1 4000 5000 0 1000 . 4000 5000 27,158,119`\r\n\r\n`chr1 5000 6000 1 1000 . 5000 6000 217,95,2`\r\n\r\n`chr1 6000 7000 2 1000 . 6000 7000 117,112,179`\r\n\r\n`chr1 7000 8000 3 1000 . 7000 8000 231,41,138`\r\n\r\nThis test case has been named `simplevirtualevidence`.", "title": "Implement virtual evidence for all segway tasks", "destination": {"commit": {"hash": "8cbdd3f79d65", "type": "commit", "links": {"self": {"href": "data/repositories/hoffmanlab/segway/commit/8cbdd3f79d65.json"}, "html": {"href": "#!/hoffmanlab/segway/commits/8cbdd3f79d65"}}}, "repository": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway.json"}, "html": {"href": "#!/hoffmanlab/segway"}, "avatar": {"href": "data/bytebucket.org/ravatar/{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}ts=python"}}, "type": "repository", "name": "segway", "full_name": "hoffmanlab/segway", "uuid": "{68bf38bf-f0c1-4c9c-909e-0ee4b2c26257}"}, "branch": {"name": "default"}}, "reason": "", "source": {"commit": {"hash": "260a2f8e8154", "type": "commit", "links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23/commit/260a2f8e8154"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23/commits/260a2f8e8154"}}}, "repository": {"links": {"self": {"href": "https://api.bitbucket.org/2.0/repositories/mjmm13/segway_python23"}, "html": {"href": "https://bitbucket.org/mjmm13/segway_python23"}, "avatar": {"href": "data/bytebucket.org/ravatar/{735c8db4-9d46-48a5-95b3-1d01db953c08}ts=python"}}, "type": "repository", "name": "segway_python23", "full_name": "mjmm13/segway_python23", "uuid": "{735c8db4-9d46-48a5-95b3-1d01db953c08}"}, "branch": {"name": "ve"}}, "state": "OPEN", "author": {"display_name": "Matthew McNeil", "uuid": "{018cd21a-1658-4202-9b1e-99dabc3e14d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D"}, "html": {"href": "https://bitbucket.org/%7B018cd21a-1658-4202-9b1e-99dabc3e14d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d7e7604c308bd957d77e1762b5caeddcd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsMM-5.png"}}, "nickname": "mjmm13", "type": "user", "account_id": "5ac790531b5dd37ea53a123d"}, "date": "2020-01-06T06:14:27.246096+00:00"}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129816394.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129816394"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "@{5ac790531b5dd37ea53a123d} This is ready for your revision", "markup": "markdown", "html": "<p><span class=\"ap-mention\" data-atlassian-id=\"5ac790531b5dd37ea53a123d\">@Matthew McNeil</span> This is ready for your revision</p>", "type": "rendered"}, "created_on": "2019-12-23T19:43:32.978916+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2019-12-23T19:43:32.989693+00:00", "type": "pullrequest_comment", "id": 129816394}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129816220.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129816220"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "Avoid use of the variable name in the comment if possible especially if if it used multiple times on the next line \\(since the end `res` is not actually transposed\\). The tranpose is happening on a prior input array. So \u201cpositions\u201d refer to \u201cpriors\u201d in this example?", "markup": "markdown", "html": "<p>Avoid use of the variable name in the comment if possible especially if if it used multiple times on the next line (since the end <code>res</code> is not actually transposed). The tranpose is happening on a prior input array. So \u201cpositions\u201d refer to \u201cpriors\u201d in this example?</p>", "type": "rendered"}, "created_on": "2019-12-23T19:40:20.671412+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2019-12-23T19:40:20.677456+00:00", "type": "pullrequest_comment", "id": 129816220}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129815945.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129815945"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "As per requested by @{557058:a9657985-692c-405c-995b-4e41cda7ba2b} Place this entire explanation before the \u201cFor example\u201d portion.", "markup": "markdown", "html": "<p>As per requested by <span class=\"ap-mention\" data-atlassian-id=\"557058:a9657985-692c-405c-995b-4e41cda7ba2b\">@Michael Hoffman</span> Place this entire explanation before the \u201cFor example\u201d portion.</p>", "type": "rendered"}, "created_on": "2019-12-23T19:35:52.931926+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2019-12-23T19:35:52.948131+00:00", "type": "pullrequest_comment", "id": 129815945}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129814696.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129814696"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "This is a better explaination, however the genomic context is not very relevant to the function itself. Use more generic terms instead of the genomic nomenclature and try to stay specific to the function.", "markup": "markdown", "html": "<p>This is a better explaination, however the genomic context is not very relevant to the function itself. Use more generic terms instead of the genomic nomenclature and try to stay specific to the function.</p>", "type": "rendered"}, "created_on": "2019-12-23T19:17:13.412808+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2019-12-23T19:17:13.418997+00:00", "type": "pullrequest_comment", "id": 129814696}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129814579.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129814579"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "When breaking out this to a function like `check_is_close` you should just raise the `PriorSizeWarning` in there and try/catch here. The reason for this is for better contextual error messages. This error message in particular could be far more helpful. Getting an index printed out for some small downsampled resolution region is not at all. Perhaps showing which values summed to be >1 \\(in this example\\) would be better so at least a user can search for the particular offending prior combination.", "markup": "markdown", "html": "<p>When breaking out this to a function like <code>check_is_close</code> you should just raise the <code>PriorSizeWarning</code> in there and try/catch here. The reason for this is for better contextual error messages. This error message in particular could be far more helpful. Getting an index printed out for some small downsampled resolution region is not at all. Perhaps showing which values summed to be &gt;1 (in this example) would be better so at least a user can search for the particular offending prior combination.</p>", "type": "rendered"}, "created_on": "2019-12-23T19:15:20.022521+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {}, "updated_on": "2019-12-23T19:15:20.027488+00:00", "type": "pullrequest_comment", "id": 129814579}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}, {"comment": {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100/comments/129814375.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100/_/diff#comment-129814375"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}, "content": {"raw": "This may have got lost in an e-mail discussion, however as per requested by @{557058:a9657985-692c-405c-995b-4e41cda7ba2b} \\(his words below\\):\n\n```\nbreak out the current EPSILON checks to use a new check_is_close() function that\n1.checks whether things sum exactly to 1.0 or 0.0 or whatever is wanted\n\n2. use warning.warn() with a custom warn class if there is any deviation (and specify the amount of the deviation)\n```\n\nThe warning class has been addressed - just the function would need to be added", "markup": "markdown", "html": "<p>This may have got lost in an e-mail discussion, however as per requested by <span class=\"ap-mention\" data-atlassian-id=\"557058:a9657985-692c-405c-995b-4e41cda7ba2b\">@Michael Hoffman</span> (his words below):</p>\n<div class=\"codehilite\"><pre><span></span>break out the current EPSILON checks to use a new check_is_close() function that\n1.checks whether things sum exactly to 1.0 or 0.0 or whatever is wanted\n\n2. use warning.warn() with a custom warn class if there is any deviation (and specify the amount of the deviation)\n</pre></div>\n\n\n<p>The warning class has been addressed - just the function would need to be added</p>", "type": "rendered"}, "created_on": "2019-12-23T19:11:45.474982+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "updated_on": "2019-12-23T19:11:45.491394+00:00", "type": "pullrequest_comment", "id": 129814375}, "pull_request": {"type": "pullrequest", "id": 100, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/100.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/100"}}, "title": "Implement virtual evidence for all segway tasks"}}], "next": "data/repositories/hoffmanlab/segway/pullrequests/100/activity_ctx=EjhnXsbSA.json"}
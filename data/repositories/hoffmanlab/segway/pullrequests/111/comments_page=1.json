{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113966737.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:acff36c6771e..9d6cdcaa85b3?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113966737"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "This is not supported on Network File Systems \\(NFS\\) and _might_ cause issues. From the \u201copen\u201d man page:\n\n\u2018O\\_APPEND may lead to corrupted files on NFS file systems if more than one process appends data to a file at once.  This is because NFS does not support appending to a file, so the client kernel has to simulate it, which can't be done without a race condition.\u2019\n\nThe potential issue is by the time the append is \u2018simulated\u2019 there could be an issue where the script is read before the final append actually takes place on NFS. This would potentially be awfully subtle since it means omitting the occasional EM job before each bundle.", "markup": "markdown", "html": "<p>This is not supported on Network File Systems (NFS) and <em>might</em> cause issues. From the \u201copen\u201d man page:</p>\n<p>\u2018O_APPEND may lead to corrupted files on NFS file systems if more than one process appends data to a file at once.  This is because NFS does not support appending to a file, so the client kernel has to simulate it, which can't be done without a race condition.\u2019</p>\n<p>The potential issue is by the time the append is \u2018simulated\u2019 there could be an issue where the script is read before the final append actually takes place on NFS. This would potentially be awfully subtle since it means omitting the occasional EM job before each bundle.</p>", "type": "rendered"}, "created_on": "2019-08-21T19:34:15.238127+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-21T19:34:15.245414+00:00", "type": "pullrequest_comment", "id": 113966737}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113970382.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:acff36c6771e..9d6cdcaa85b3?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113970382"}}, "parent": {"id": 113966737, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113966737.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113966737"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "Aren\u2019t those separate issues? 1\\) NFS doesn\u2019t support O\\_APPEND natively, so one cannot append to the same file with multiple processes at once. But each batch script is unique to its instance, so there will only be one process writing to it at a time? 2\\) Is this not the typical NFS issue where the file write might not be synced immediately?", "markup": "markdown", "html": "<p>Aren\u2019t those separate issues? 1) NFS doesn\u2019t support O_APPEND natively, so one cannot append to the same file with multiple processes at once. But each batch script is unique to its instance, so there will only be one process writing to it at a time? 2) Is this not the typical NFS issue where the file write might not be synced immediately?</p>", "type": "rendered"}, "created_on": "2019-08-21T20:06:51.813337+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-21T20:07:37.397765+00:00", "type": "pullrequest_comment", "id": 113970382}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113972027.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:acff36c6771e..9d6cdcaa85b3?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113972027"}}, "parent": {"id": 113970382, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113970382.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113970382"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "1. Even if each batch script is unique to it\u2019s instance, the submitted job will be on a different host potentially reading from the file. The issue is not a write-write race condition but a write-read race condition that is exacerbated by the fact that there is a bunch of append operations taking place which may or may not sync by the same time another machine is reading from it.\n2. So yes it\u2019s a typical syncing on NFS issue. However if you just do a single write \\(with all jobs\\) it is much preferred since either you get all or nothing on another host anyway.\n\nGenerally if this all takes place on the same host it should not be a big issue I\u2019d imagine since NFS typically caches the writes out to files like crazy but then you\u2019d have to do all this weird job management inside segway-task. I\u2019m not sure what the best quick approach to this is. Perhaps partitioning jobs inside the RestartableJobDict when things are queued in and only writing out the would-be job when the limit for a partition is hit?\n\n@{557058:a9657985-692c-405c-995b-4e41cda7ba2b}  might have some insight on this issue.", "markup": "markdown", "html": "<ol>\n<li>Even if each batch script is unique to it\u2019s instance, the submitted job will be on a different host potentially reading from the file. The issue is not a write-write race condition but a write-read race condition that is exacerbated by the fact that there is a bunch of append operations taking place which may or may not sync by the same time another machine is reading from it.</li>\n<li>So yes it\u2019s a typical syncing on NFS issue. However if you just do a single write (with all jobs) it is much preferred since either you get all or nothing on another host anyway.</li>\n</ol>\n<p>Generally if this all takes place on the same host it should not be a big issue I\u2019d imagine since NFS typically caches the writes out to files like crazy but then you\u2019d have to do all this weird job management inside segway-task. I\u2019m not sure what the best quick approach to this is. Perhaps partitioning jobs inside the RestartableJobDict when things are queued in and only writing out the would-be job when the limit for a partition is hit?</p>\n<p><span class=\"ap-mention\" data-atlassian-id=\"557058:a9657985-692c-405c-995b-4e41cda7ba2b\">@Michael Hoffman</span>  might have some insight on this issue.</p>", "type": "rendered"}, "created_on": "2019-08-21T20:22:01.004051+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-21T20:22:17.985525+00:00", "type": "pullrequest_comment", "id": 113972027}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113975278.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:acff36c6771e..9d6cdcaa85b3?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113975278"}}, "parent": {"id": 113972027, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113972027.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113972027"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "A much less invasive alternative is to simply write each subjob as its own job script as usual, and then \u2018cat\u2019 them all together into a single, separate batch job script before submission. Would that work?", "markup": "markdown", "html": "<p>A much less invasive alternative is to simply write each subjob as its own job script as usual, and then \u2018cat\u2019 them all together into a single, separate batch job script before submission. Would that work?</p>", "type": "rendered"}, "created_on": "2019-08-21T20:51:26.477381+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-21T20:51:26.488033+00:00", "type": "pullrequest_comment", "id": 113975278}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114122139.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:acff36c6771e..9d6cdcaa85b3?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114122139"}}, "parent": {"id": 113975278, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/113975278.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-113975278"}}, "depth": 4}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "I think so yes", "markup": "markdown", "html": "<p>I think so yes</p>", "type": "rendered"}, "created_on": "2019-08-22T16:09:22.325379+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-22T16:09:22.337434+00:00", "type": "pullrequest_comment", "id": 114122139}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114137573.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:b76b84107a4a..8cbdd3f79d65?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114137573"}}, "parent": {"id": 114122139, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114122139.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114122139"}}, "depth": 5}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "@{557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee} I\u2019ve modified the PR so that subjob scripts are written separately before being cat-ed together all at once prior to the batch job submission.", "markup": "markdown", "html": "<p><span class=\"ap-mention ap-mention-me\" data-atlassian-id=\"557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee\">@Eric Roberts</span> I\u2019ve modified the PR so that subjob scripts are written separately before being cat-ed together all at once prior to the batch job submission.</p>", "type": "rendered"}, "created_on": "2019-08-22T18:10:11.290449+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "inline": {"to": 268, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-22T18:10:22.822233+00:00", "type": "pullrequest_comment", "id": 114137573}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114450721.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:b76b84107a4a..8cbdd3f79d65?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114450721"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "This is minor but you\u2019re still writing each subjob separately. Should be technically safer to loop through and read everything into a buffer/array and then write out everything at once \\(outside the `for` loop\\).", "markup": "markdown", "html": "<p>This is minor but you\u2019re still writing each subjob separately. Should be technically safer to loop through and read everything into a buffer/array and then write out everything at once (outside the <code>for</code> loop).</p>", "type": "rendered"}, "created_on": "2019-08-26T16:14:04.048253+00:00", "user": {"display_name": "Eric Roberts", "uuid": "{cd8c1fe0-28ca-45fb-8ef9-48090b42bb80}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D"}, "html": {"href": "https://bitbucket.org/%7Bcd8c1fe0-28ca-45fb-8ef9-48090b42bb80%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/17548d71dfb29d015b880f48cfc01ca3d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsER-5.png"}}, "nickname": "ericr86", "type": "user", "account_id": "557058:c80ca578-03a1-4ac6-b3ee-50372a3fceee"}, "inline": {"to": 2378, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-26T16:14:04.060548+00:00", "type": "pullrequest_comment", "id": 114450721}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114463351.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/hoffmanlab/segway/diff/rcwchan/segway-1:5c3ba8021f9e..8cbdd3f79d65?path=segway%2Frun.py"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114463351"}}, "parent": {"id": 114450721, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/114450721.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-114450721"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "Thanks Eric! I\u2019ve modified the code so that each subjob script is read into a large array which is written at once at the end.", "markup": "markdown", "html": "<p>Thanks Eric! I\u2019ve modified the code so that each subjob script is read into a large array which is written at once at the end.</p>", "type": "rendered"}, "created_on": "2019-08-26T17:56:07.016404+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "inline": {"to": 2378, "from": null, "path": "segway/run.py"}, "updated_on": "2019-08-26T17:56:07.026432+00:00", "type": "pullrequest_comment", "id": 114463351}, {"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111/comments/116891452.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111/_/diff#comment-116891452"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 111, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/111.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/111"}}, "title": "Modify Segway's scheduling to allow for 'batch' job submission in training"}, "content": {"raw": "For whoever picks this PR up next: currently, errors in individual jobs in the batch get reported in output/e but do not result in a non-zero exit status for the batch job as a whole. That is, any train job issues are only noticed on a high level when Segway attempts to run the bundle job \\(and errors out\\). Instead, subjob errors should result in a nonzero exit status for the batch job.", "markup": "markdown", "html": "<p>For whoever picks this PR up next: currently, errors in individual jobs in the batch get reported in output/e but do not result in a non-zero exit status for the batch job as a whole. That is, any train job issues are only noticed on a high level when Segway attempts to run the bundle job (and errors out). Instead, subjob errors should result in a nonzero exit status for the batch job.</p>", "type": "rendered"}, "created_on": "2019-09-13T20:16:13.914490+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "updated_on": "2019-09-13T20:16:13.921895+00:00", "type": "pullrequest_comment", "id": 116891452}], "page": 1, "size": 9}
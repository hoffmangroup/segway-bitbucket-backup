{"links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/52/comments/20536921.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/52/_/diff#comment-20536921"}}, "parent": {"id": 20533746, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/52/comments/20533746.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/52/_/diff#comment-20533746"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 52, "links": {"self": {"href": "data/repositories/hoffmanlab/segway/pullrequests/52.json"}, "html": {"href": "#!/hoffmanlab/segway/pull-requests/52"}}, "title": "Resubmit the mixtures of Gaussians code"}, "content": {"raw": "Which additional fixes are you referring to exactly? These are the only differences I can find:\n\n(1)  Lines 670-672 in yours. In particular, I did not take out the lines\n\n```\n#!python\n\n-        elif self.zscore:\n-            tracks_means = genome.means\n-            tracks_vars = genome.vars\n```\n\nbecause I was not sure of their purpose yet, hence the original question in this thread. \n\n(2) Additionally, your changes to the function calls in line 692-695:\n\n\n```\n#!python\n\n         with Genome(self.genomedata_names[0]) as genome:\n             observations.locate_windows(genome)\n             self.windows = observations.windows\n             # XXX: does this need to be done before save()?\n             self.subset_metadata()\n-            \n-            observations.save(genome)\n+\n+        observations.save()\n```\n\nare different from mine in that I preserved the original code (before this GMM patch), which should be:\n\n\n```\n#!python\n\n        observations = Observations(self)\n\n        # Use the first genomedata archive for locating windows\n        with Genome(self.genomedata_names[0]) as genome:\n            observations.locate_windows(genome)\n\n        self.windows = observations.windows\n        # XXX: does this need to be done before save()?\n        self.subset_metadata()\n        observations.save()\n```\nIn particular, I think you have an extra indent in the last 3 lines of the ```with``` block, and it makes the code quite different.\n\n(3) In addition, you have imported python's random module, which we removed in an earlier patch (so it should be re-replaced by ```import numpy.random```) because it was not seeded correctly, and rather than seeding two different RNGs, we chose to only seed one (numpy.random). \n\n(4) The other big difference is that in lines 656-658, you have done:\n\n\n```\n#!python\n\n+            tracks_num_datapoints = []\n+            tracks_sums = []\n+            tracks_sums_squared = []\n```\n\nwhereas I tried to check if track_sums already existed (so as to preserve the original code in this patch):\n\n```\n#!python\n\n\n+                        if track_sums is None:\n+                            tracks_sums = [0]*genome.num_tracks_continuous\n+                            tracks_num_datapoints = [0]*genome.num_tracks_continuous\n+                            tracks_sums_squared = [0]*genome.num_tracks_continuous\n```\n\nThis is open to being replaced by a better check if there is one, however.\n\n(5) Also, you chose to zip track_indexes and genomedata_names in a zipper, which is redundant since I don't think we actually use the track_index anywhere. I have bypassed this by simply doing ```for genomedata_name in genomedata_names``` in line 659 of my patch.\n\n(6) In addition, I think in lines 693-694 in your patch,\n\n```\n#!python\n\n\n                 chromosome = genome[chrom]\n                 seq_cells = self.make_seq_cells(chromosome, start, end)\n```\n\nshould be \n\n```\n#!python\n\n+                with Genome(genomedata_name) as genome:\n+                    chromosome = genome[chrom]\n+                    seq_cells = self.make_seq_cells(chromosome, start, end)\n```\n\nas in the original pre-GMM code:\n\n```\n#!python\n\n                with Genome(genomedata_name) as genome:\n                    chromosome = genome[chrom]\n                    seq_cells = self.make_seq_cells(chromosome, start, end)\n```\n\nAside from these 6 things, I do not see any additional differences in yours. Please let me know if I have missed any. Thanks!", "markup": "markdown", "html": "<p>Which additional fixes are you referring to exactly? These are the only differences I can find:</p>\n<p>(1)  Lines 670-672 in yours. In particular, I did not take out the lines</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">-</span>        <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">zscore</span><span class=\"p\">:</span>\n<span class=\"o\">-</span>            <span class=\"n\">tracks_means</span> <span class=\"o\">=</span> <span class=\"n\">genome</span><span class=\"o\">.</span><span class=\"n\">means</span>\n<span class=\"o\">-</span>            <span class=\"n\">tracks_vars</span> <span class=\"o\">=</span> <span class=\"n\">genome</span><span class=\"o\">.</span><span class=\"n\">vars</span>\n</pre></div>\n\n\n<p>because I was not sure of their purpose yet, hence the original question in this thread. </p>\n<p>(2) Additionally, your changes to the function calls in line 692-695:</p>\n<div class=\"codehilite language-python\"><pre><span></span>         <span class=\"k\">with</span> <span class=\"n\">Genome</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">genomedata_names</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"k\">as</span> <span class=\"n\">genome</span><span class=\"p\">:</span>\n             <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">locate_windows</span><span class=\"p\">(</span><span class=\"n\">genome</span><span class=\"p\">)</span>\n             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">windows</span> <span class=\"o\">=</span> <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">windows</span>\n             <span class=\"c1\"># XXX: does this need to be done before save()?</span>\n             <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">subset_metadata</span><span class=\"p\">()</span>\n<span class=\"o\">-</span>            \n<span class=\"o\">-</span>            <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">genome</span><span class=\"p\">)</span>\n<span class=\"o\">+</span>\n<span class=\"o\">+</span>        <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n</pre></div>\n\n\n<p>are different from mine in that I preserved the original code (before this GMM patch), which should be:</p>\n<div class=\"codehilite language-python\"><pre><span></span>        <span class=\"n\">observations</span> <span class=\"o\">=</span> <span class=\"n\">Observations</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Use the first genomedata archive for locating windows</span>\n        <span class=\"k\">with</span> <span class=\"n\">Genome</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">genomedata_names</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"k\">as</span> <span class=\"n\">genome</span><span class=\"p\">:</span>\n            <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">locate_windows</span><span class=\"p\">(</span><span class=\"n\">genome</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">windows</span> <span class=\"o\">=</span> <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">windows</span>\n        <span class=\"c1\"># XXX: does this need to be done before save()?</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">subset_metadata</span><span class=\"p\">()</span>\n        <span class=\"n\">observations</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n</pre></div>\n\n\n<p>In particular, I think you have an extra indent in the last 3 lines of the <code>with</code> block, and it makes the code quite different.</p>\n<p>(3) In addition, you have imported python's random module, which we removed in an earlier patch (so it should be re-replaced by <code>import numpy.random</code>) because it was not seeded correctly, and rather than seeding two different RNGs, we chose to only seed one (numpy.random). </p>\n<p>(4) The other big difference is that in lines 656-658, you have done:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">+</span>            <span class=\"n\">tracks_num_datapoints</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"o\">+</span>            <span class=\"n\">tracks_sums</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"o\">+</span>            <span class=\"n\">tracks_sums_squared</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</pre></div>\n\n\n<p>whereas I tried to check if track_sums already existed (so as to preserve the original code in this patch):</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">+</span>                        <span class=\"k\">if</span> <span class=\"n\">track_sums</span> <span class=\"ow\">is</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n<span class=\"o\">+</span>                            <span class=\"n\">tracks_sums</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">*</span><span class=\"n\">genome</span><span class=\"o\">.</span><span class=\"n\">num_tracks_continuous</span>\n<span class=\"o\">+</span>                            <span class=\"n\">tracks_num_datapoints</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">*</span><span class=\"n\">genome</span><span class=\"o\">.</span><span class=\"n\">num_tracks_continuous</span>\n<span class=\"o\">+</span>                            <span class=\"n\">tracks_sums_squared</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">*</span><span class=\"n\">genome</span><span class=\"o\">.</span><span class=\"n\">num_tracks_continuous</span>\n</pre></div>\n\n\n<p>This is open to being replaced by a better check if there is one, however.</p>\n<p>(5) Also, you chose to zip track_indexes and genomedata_names in a zipper, which is redundant since I don't think we actually use the track_index anywhere. I have bypassed this by simply doing <code>for genomedata_name in genomedata_names</code> in line 659 of my patch.</p>\n<p>(6) In addition, I think in lines 693-694 in your patch,</p>\n<div class=\"codehilite language-python\"><pre><span></span>                 <span class=\"n\">chromosome</span> <span class=\"o\">=</span> <span class=\"n\">genome</span><span class=\"p\">[</span><span class=\"n\">chrom</span><span class=\"p\">]</span>\n                 <span class=\"n\">seq_cells</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_seq_cells</span><span class=\"p\">(</span><span class=\"n\">chromosome</span><span class=\"p\">,</span> <span class=\"n\">start</span><span class=\"p\">,</span> <span class=\"n\">end</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>should be </p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">+</span>                <span class=\"k\">with</span> <span class=\"n\">Genome</span><span class=\"p\">(</span><span class=\"n\">genomedata_name</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">genome</span><span class=\"p\">:</span>\n<span class=\"o\">+</span>                    <span class=\"n\">chromosome</span> <span class=\"o\">=</span> <span class=\"n\">genome</span><span class=\"p\">[</span><span class=\"n\">chrom</span><span class=\"p\">]</span>\n<span class=\"o\">+</span>                    <span class=\"n\">seq_cells</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_seq_cells</span><span class=\"p\">(</span><span class=\"n\">chromosome</span><span class=\"p\">,</span> <span class=\"n\">start</span><span class=\"p\">,</span> <span class=\"n\">end</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>as in the original pre-GMM code:</p>\n<div class=\"codehilite language-python\"><pre><span></span>                <span class=\"k\">with</span> <span class=\"n\">Genome</span><span class=\"p\">(</span><span class=\"n\">genomedata_name</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">genome</span><span class=\"p\">:</span>\n                    <span class=\"n\">chromosome</span> <span class=\"o\">=</span> <span class=\"n\">genome</span><span class=\"p\">[</span><span class=\"n\">chrom</span><span class=\"p\">]</span>\n                    <span class=\"n\">seq_cells</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">make_seq_cells</span><span class=\"p\">(</span><span class=\"n\">chromosome</span><span class=\"p\">,</span> <span class=\"n\">start</span><span class=\"p\">,</span> <span class=\"n\">end</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>Aside from these 6 things, I do not see any additional differences in yours. Please let me know if I have missed any. Thanks!</p>", "type": "rendered"}, "created_on": "2016-07-03T16:55:52.866596+00:00", "user": {"display_name": "Rachel Chan", "uuid": "{20430f8d-4e6b-48cc-a8d8-c64868bf7e79}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D"}, "html": {"href": "https://bitbucket.org/%7B20430f8d-4e6b-48cc-a8d8-c64868bf7e79%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/4397abec9f84e35f1f235b350984833dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsRC-1.png"}}, "nickname": "rcwchan", "type": "user", "account_id": "557058:e439e22e-8cfc-4cf1-b090-030d33a0730e"}, "updated_on": "2016-07-03T17:25:43.328355+00:00", "type": "pullrequest_comment", "id": 20536921}